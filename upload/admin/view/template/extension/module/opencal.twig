{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="float-right">
        <button type="submit" form="form-module" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fas fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-light"><i class="fas fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ol class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
          <li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ol>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
      <div class="alert alert-danger alert-dismissible"><i class="fas fa-exclamation-circle"></i> {{ error_warning }}
        <button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
    {% endif %}
    <div class="card">
      <div class="card-header"><i class="fas fa-pencil-alt"></i> {{ text_edit }}</div>
      <div class="card-body">
        <ul class="nav nav-tabs">
          <li class="nav-item"><a href="#tab-general" data-toggle="tab" class="nav-link active">{{ tab_opencal }}</a></li>
          <li class="nav-item"><a href="#tab-order-status" data-toggle="tab" class="nav-link">{{ tab_opencal_settings }}</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active text-center" id="tab-general">
                {% if module_opencal_status and module_opencal_code %}
                    
  
 
  
  
  
  
  
                    <script>

  $(document).ready(function() {

    $('#calendar').fullCalendar({
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay'
      },
      defaultDate: '2018-03-12',
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectHelper: true,
      select: function(start, end) {
            $('#modalTitle').html('New Event');
            $('#eventTitle').val('');
            
            start = start.toISOString().replace(/T/g," "); //remove "T" from the string
            if(start.indexOf(':') > -1) {
                start = start.slice(0, -3); //remove seconds from the string
            }
            end = end.toISOString().replace(/T/g," "); //remove "T" from the string
            if(end.indexOf(':') > -1) {
                end = end.slice(0, -3); //remove seconds from the string
            }
            
            $('#eventStart').val(start);
            $('#eventEnd').val(end);
            $('#eventId').val('');
            $('#eventColour').val('');
            $('#eventBody').val('');
            $("#fullCalRemove").hide();
            $('#fullCalModal').modal();
        
            $('#calendar').fullCalendar('unselect');
      },
        eventClick:  function(event, jsEvent, view) {
            console.log(event.color);
            $('#modalTitle').html(event.title);
            
            end = event.end ? event.end : event.start;
            start = event.start.toISOString().replace(/T/g," "); //remove "T" from the string
            if(start.indexOf(':') > -1) {
                start = start.slice(0, -3); //remove seconds from the string
            }
            end = end.toISOString().replace(/T/g," "); //remove "T" from the string
            if(end.indexOf(':') > -1) {
                end = end.slice(0, -3); //remove seconds from the string
            }
            console.log(event.id);
            $('#eventId').val(event.id);
            $('#eventTitle').val(event.title);
            $('#eventStart').val(start);
            $('#eventEnd').val(end);
            $('#eventColour').val(event.color ? event.color : '');
            $('#eventBody').val(event.description ? event.description : '');
            $("#fullCalRemove").show();
            $('#fullCalModal').modal();
        },
      editable: true,
      eventLimit: true, // allow "more" link when too many events
      eventTextColor: '#fff',
      eventBackgroundColor: '#5484ed',
      events: [
        {
          id: 1,
          title: 'All Day Event',
          start: '2018-03-01',
          description: 'blar blar blar',
          color: '#51b749'
        },
        {
          id: 2,
          title: 'Long Event',
          start: '2018-03-07',
          end: '2018-03-10'
        },
        {
          id: 999,
          title: 'Repeating Event',
          start: '2018-03-09T16:00:00'
        },
        {
          id: 999,
          title: 'Repeating Event',
          start: '2018-03-16T16:00:00'
        },
        {
          id: 3,
          title: 'Conference',
          start: '2018-03-11',
          end: '2018-03-13'
        },
        {
          id: 4,
          title: 'Meeting',
          start: '2018-03-12T10:30:00',
          end: '2018-03-12T12:30:00'
        },
        {
          id: 5,
          title: 'Lunch',
          start: '2018-03-12T12:00:00'
        },
        {
          id: 6,
          title: 'Meeting',
          start: '2018-03-12T14:30:00'
        },
        {
          id: 7,
          title: 'Happy Hour',
          start: '2018-03-12T17:30:00'
        },
        {
          id: 9,
          title: 'Dinner',
          start: '2018-03-12T20:00:00'
        },
        {
          id: 8,
          title: 'Birthday Party',
          start: '2018-03-13T07:00:00'
        },
        {
          id: 10,
          title: 'Click for Google',
          url: 'http://google.com/',
          start: '2018-03-28'
        }
      ]
    });
    
    $( "#fullCalRemove" ).on( "click", function() {
        $('#calendar').fullCalendar('removeEvents', [$('#eventId').val()]);
        $('#fullCalModal').modal('hide');
    });
    
    $( "#fullCalSave" ).on( "click", function() {
        var eventData;
        if ($('#eventTitle').val() && $('#eventStart').val() && $('#eventEnd').val()) {
            eventData = {
                title:  $('#eventTitle').val(),
                start:  $('#eventStart').val(),
                end:    $('#eventEnd').val()
            };
            $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
        }        
        
        $('#fullCalModal').modal('hide');
    });

  });
  
  // Refresh calendar every 1 minute
  function fcRefresh() {
      
  }
  
  setInterval(fcRefresh, 60*1000);
  </script>
  
  
  <style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 900px;
    margin: 0 auto;
  }

</style>



<div id="fullCalModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="modalTitle" class="modal-title"></h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span> <span class="sr-only">close</span></button>
            </div>
            <input type="hidden" name="eventid" id="eventId"/>
            <div class="m-3 text-left">Title: <input type="text" name="eventtitle" id="eventTitle" class="w-100"/></div>
            <div class="m-3 text-left">Start: <input type="text" name="eventstart" id="eventStart" class="w-100" readonly="1"/></div>
            <div class="m-3 text-left">End: <input type="text" name="eventend" id="eventEnd" class="w-100" readonly="1"/></div>
            <div class="m-3 text-left">
                Colour:
                <select name="eventcolour" id="eventColour">
                    <option value="#5484ed" id="ec9">Bold blue</option>
                    <option value="#a4bdfc" id="ec1">Blue</option>
                    <option value="#46d6db" id="ec7">Turquoise</option>
                    <option value="#7ae7bf" id="ec2">Light green</option>
                    <option value="#51b749" id="ec10">Bold green</option>
                    <option value="#fbd75b" id="ec5">Yellow</option>
                    <option value="#ffb878" id="ec6">Orange</option>
                    <option value="#ff887c" id="ec4">Red</option>
                    <option value="#dc2127" id="ec11">Bold red</option>
                    <option value="#dbadff" id="ec3">Purple</option>
                    <option value="#e1e1e1" id="ec8">Gray</option>
                </select>
            </div>
            <div class="m-3 text-left">Description: <textarea name="eventbody" id="eventBody" class="w-100" rows="10"></textarea></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="fullCalSave">Save</button>
                <button type="button" class="btn" id="fullCalRemove">Remove</button>
            </div>
        </div>
    </div>
</div>
  
<script>
    $('#eventStart').datetimepicker({
        dateFormat: 'yy-mm-dd', 
        timeFormat: 'HH:mm',
    });
    $('#eventEnd').datetimepicker({
        dateFormat: 'yy-mm-dd', 
        timeFormat: 'HH:mm',
    });
    
    $('select[name="eventcolour"]').simplecolorpicker();
    </script>
  
  <div id="calendar"></div>
                {% else %}
                    <label>{{ text_setup }}</label>
                {% endif %}
            </div>
            <div class="tab-pane" id="tab-order-status">
                <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-module">
                  <div class="form-group row required">
                    <label class="col-sm-2 col-form-label" for="input-code">{{ entry_code }}</label>
                    <div class="col-sm-10">
                      <textarea name="module_opencal_code" rows="5" id="input-code" class="form-control">{{ module_opencal_code }}</textarea>
                      <small class="form-text text-muted">{{ help_code|raw }}</small>
                      {% if error_code %}
                        <div class="invalid-tooltip">{{ error_code }}</div>
                      {% endif %}
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-2 col-form-label" for="input-status">{{ entry_status }}</label>
                    <div class="col-sm-10">
                      <select name="module_opencal_status" id="input-status" class="form-control">
                        {% if module_opencal_status %}
                          <option value="1" selected="selected">{{ text_enabled }}</option>
                          <option value="0">{{ text_disabled }}</option>
                        {% else %}
                          <option value="1">{{ text_enabled }}</option>
                          <option value="0" selected="selected">{{ text_disabled }}</option>
                        {% endif %}
                      </select>
                    </div>
                  </div>
                </form>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>
{{ footer }}